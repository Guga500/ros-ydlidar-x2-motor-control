<launch>
  <!-- ตั้งค่าตำแหน่ง/ทิศ Lidar (yaw เป็นเรเดียน) -->
  <arg name="lidar_x"     default="0.15"/>
  <arg name="lidar_y"     default="0.00"/>
  <arg name="lidar_z"     default="0.18"/>
  <arg name="lidar_yaw"   default="0.0"/>
  <arg name="lidar_frame" default="laser_frame"/>

  <!-- 1) YDLIDAR X2 driver -->
  <include file="$(find ydlidar_ros_driver)/launch/X2.launch"/>

  <!-- 2) TF: base_footprint -> lidar_frame (ใช้ tf2_ros) -->
  <!-- รูปแบบ: x y z roll pitch yaw parent child -->
  <node pkg="tf2_ros" type="static_transform_publisher" name="base_to_laser"
        args="$(arg lidar_x) $(arg lidar_y) $(arg lidar_z) 0 0 $(arg lidar_yaw) base_footprint $(arg lidar_frame)"/>

  <!-- 3) GMapping (จูนสำหรับ X2 ~5Hz + ฐานล้อเล็ก) -->
  <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
    <param name="base_frame" value="base_footprint"/>
    <param name="odom_frame" value="odom"/>
    <param name="map_frame"  value="map"/>

    <!-- X2: ระยะจริง -->
    <param name="maxRange"   value="2.0"/>
    <param name="maxUrange"  value="2.0"/>
    <param name="minimumRange" value="0.1"/>
    <param name="throttle_scans" value="1"/>

    <!-- อัปเดตเมื่อขยับพอควร เพื่อให้ทัน 5Hz -->
    <param name="linearUpdate"  value="0.25"/>    <!-- m -->
    <param name="angularUpdate" value="0.30"/>    <!-- rad (~17°) -->
    <param name="temporalUpdate" value="1.0"/>    <!-- s -->

    <!-- ความละเอียด/ขอบเขตแผนที่ -->
    <param name="xmin" value="-15.0"/>
    <param name="ymin" value="-15.0"/>
    <param name="xmax" value="15.0"/>
    <param name="ymax" value="15.0"/>
    <param name="delta" value="0.05"/>

    <!-- โมเดลความไม่แน่นอน odom -->
    <param name="srr" value="0.10"/>
    <param name="srt" value="0.20"/>
    <param name="str" value="0.10"/>
    <param name="stt" value="0.20"/>

    <!-- ความเสถียรของตัวกรอง -->
    <param name="particles" value="80"/>
    <param name="resampleThreshold" value="0.5"/>
    <param name="iterations" value="5"/>
    <param name="occ_thresh" value="0.25"/>
    <!-- (ตัวเลือก) เพิ่ม minimumScore ถ้าโลคอลไลเซชันหลุดง่าย -->
    <!-- <param name="minimumScore" value="50"/> -->
  </node>

  <node pkg="my_robot" type="odom_to_tf.py" name="odom_to_tf" output="screen">
  <param name="base_frame" value="base_footprint"/>  
  <param name="odom_frame" value="odom"/>
</node>

</launch>

